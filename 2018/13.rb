# 1. I mixed up my x and y when building the track array so that was confusing
# 2. I kept trying to model the direction such that I could perform fewer ops when I got to a turn
# 3. Translating into cardinal directions was only helpful for me to visualize


class Cart
  TURNS = [1, 0, -1]
  COMPASS = %w(N W S E)

  DIRECTION = {
    '^' => 'N',
    '>' => 'E',
    'v' => 'S',
    '<' => 'W',
  }
  XY = {
    'N' => [0, -1],
    'E' => [1, 0],
    'S' => [0, 1],
    'W' => [-1, 0],
  }

  attr_accessor :x, :y, :turn, :track_char, :crashed

  def initialize(x:, y:, dir:, turn: TURNS.cycle)
    @x = x
    @y = y
    @turn = turn
    @dir = COMPASS.dup.rotate(COMPASS.index(dir))
    @track_char = polarity.positive? ? '-' : '|'
    @crashed = false
  end

  def heading
    @dir.first
  end

  def crash!
    @crashed = true
  end

  def pos
    [x, y]
  end

  def polarity
    return -1 if heading == 'N' || heading == 'S'
    1
  end

  def move(track, mine)
    i, j = pos

    @x +=  XY[heading][0]
    @y +=  XY[heading][1]

    new_track = track[y][x]
    case new_track
    when *Mine::CART_CHARS
      puts "Collision at #{x}, #{y}"
      mine.crash(cart: self, x: x, y: y)
    when '+' # intersection
      @dir.rotate!(turn.next)
    when '/'
      r = 1 * polarity
      @dir.rotate!(r)
    when '\\'
      r = -1 * polarity
      @dir.rotate!(r)
    end

    track[j][i] = track_char
    track[y][x] = DIRECTION.invert[heading] unless crashed
    @track_char = new_track
  end
end

class Mine
  attr_accessor :track, :carts

  CART_CHARS = %w(^ > v <)
  TURN = [-1, 0, 1]
  def initialize(track, carts)
    @track = track
    @carts = carts
  end

  def self.parse(input)
    carts = []

    arr = Array.new(input.size) { [] }
    input.each_with_index do |line, i|
      line.chars.each_with_index do |c, j|
        arr[i][j] = c

        if CART_CHARS.include?(c)
          id = carts.size + 1

          carts << Cart.new(x: j,
                            y: i,
                            dir: Cart::DIRECTION[c],
                           )
        end
      end
    end

    new(arr, carts)
  end

  def step
    carts.sort_by(&:pos).each do |cart|
      next if cart.crashed
      cart.move(track, self)
    end
  end

  def crash(cart:, x:, y:)
    cart.crash!
    other_cart = active_carts.find { |c| c.x == x && c.y == y }
    track[y][x] = other_cart.track_char
    other_cart.crash!
  end

  def active_carts
    carts.reject { |c| c.crashed }
  end

  def to_s
    track.each do |line|
      line.each do |c|
        print c
      end
      print "\n"
    end
    nil
  end
end

def test
  input = <<~'INPUT'
/->-\        
|   |  /----\
| /-+--+-\  |
| | |  | v  |
\-+-/  \-+--/
  \------/   
  INPUT

  mine = Mine.parse(input.split("\n"))
  while mine.active_carts.count > 1
    mine.step
  end

  cart = mine.active_carts.first
  if cart
    puts "x: #{cart.x}, y: #{cart.y}"
  else
    puts 'no carts left'
  end
end

test


data = DATA.read.chomp

mine = Mine.parse(data.split("\n"))

while mine.active_carts.count > 1
  mine.step
end

cart = mine.active_carts.first
puts "x: #{cart.x}, y: #{cart.y}"

__END__
                                                                 /-----------------------------------------------------------------------\            
              /----------\                                       |                             /-----------------------------------------+---------\  
              |          |            /--------------------------+-----\ /---------------------+----------------------------------\      |         |  
            /-+----------+-----\      |                 /--------+-----+-+---------------------+----------------------------------+------+---\     |  
    /-------+-+--\       |     |      |                 |  /-----+-----+-+---------------------+-------------------\              |      |   |     |  
    |       | |  |       |     |      |                 |  |     |     | |   /-----------------+-\   /-------------+\             |      |   |     |  
    |       | |  |/------+-----+---\  |               /-+--+-----+-----+-+---+-----------------+-+---+---------\   ||             |      |   |     |  
    |       | |  ||      |     |   |  |             /-+-+--+----<+-----+-+---+-----------------+-+---+---------+---++-------------+----\ |   |     |  
    |       | |  ||      |    /+---+--+------------\| | |  |     |     | |   |                 | |   |         |   ||             |    | |   |     |  
    |       | |  ||      |    ||   |  |          /-++-+-+--+-----+-----+-+---+-----------------+-+---+---------+-\ ||             |    | |   |     |  
    |       | | /++------+----++---+--+----------+-++-+-+--+-----+-----+-+---+-----------------+-+---+-------\ | | ||             |    | |   |     |  
    |       | | |||      |/---++---+--+----------+-++-+-+--+\    |     | |   |                 | |   |       | | | ||             |    | |   |     |  
    |       | | |||      ||  /++---+--+----------+-++-+-+--++\   |     | |  /+----------\      | |   |       | | | ||             |    | |   |     |  
    |   /---+-+-+++------++--+++---+--+----------+-++-+-+--+++---+-\   | \--++----------+------+-+---+-------+-+-+-++-------------/    | |   |     |  
    |/--+---+-+-+++------++--+++---+--+--\      /+-++-+-+--+++---+-+---+----++----------+------+-+---+-------+-+-+-++------------------+-+\  |     |  
    ||  |   | | |||      ||  |||   | /+--+------++-++-+-+--+++---+-+---+----++--------\ |      | |   |   /---+-+-+-++------------------+-++--+-\   |  
    ||  |   | | |||      ||  |||  /+-++--+------++-++-+-+--+++---+-+\  |    ||        | |      | |   \---+---+-+-+-+/                  | ||  | |   |  
    ||  |   | | |||      ||  |||  || ||  |      || || | |  |||  /+-++--+----++--------+\|      | |      /+---+-+-+-+-------\           | ||  | |   |  
    ||  |   | | |||      ||  |||  || ||  |      || || | |  |||  || ||  |    ||     /--+++-----\| |      ||   | | | |       |           | ||  | |   |  
    ||  |   | | |||      ||  |||  || ||  |      || || | |  |||  || ||  |    ||     |  |||     || |      ||   | | | |       |       /---+-++--+-+--\|  
    ||/-+---+-+-+++\     ||  |||  || ||  |      || || | |/-+++--++-++--+----++-----+--+++-----++-+------++---+-+-+-+\      |       |   | ||  | |  ||  
    ||| |   | | ||||     ||  |||  || ||  |      || || | || |||  || ||  |    ||     | /+++-----++-+------++>--+-+-+-++-\    |       |   | ||  | |  ||  
    ||| \---+-+-++++-----++--+++--++-++--+------++-++-+-++-+++--++-/|  |    ||     | ||||     ||/+------++---+-+-+-++-+---\|       |   | ||  | |  ||  
    |||     | | ||||     ||  |||  || ||  |      || || | || |||  ||  |  |    ||     | ||||     ||||      ||   | | | || |   ||       |   | ||  | |  ||  
    |||     | | ||||     ||  |||  || ||  |/-----++-++-+-++-+++-\||  |  |    ||     | ||||     ||||      ||   | | | || |   ||       |   | ||  | |  ||  
    |||     | | ||||  /--++--+++--++-++--++-----++-++-+-++-+++-+++--+--+----++-----+-++++-----++++------++---+-+-+-++-+---++------\|   | ||  | |  ||  
    \++-----+-+-+/||  |  ||  |||  || |\--++-----++-++-+-++-+++-+++--+--/    ||     | ||||     ||||      ||   | | | || |   ||      ||   | ||  | |  ||  
     ||     | | | ||  |  ||  |||  || |   ||     v| || | || ||| |||  |       ||     | ||||     ||||      ||   | | | || |   ||    /-++---+-++--+-+-\||  
     ||     | | | ||  |  ||  |||  || |   ||     || ||/+-++-+++-+++--+-\     ||     | ||||     ||||      ||   | | | || |   ||    | ||   | ||  | | |||  
     ||     | | | ||  |  ||  |\+--++-+---++-----++-/||| || ||| |||  | |     ||     | ||||     ||||      ||   | |/+-++-+---++----+-++---+-++--+\| |||  
     ||     | | | ||  |  ||  | |  || |   ||     ||  ||| || ||| |||  | |     ||     | ||||     ||||      \+---+-+++-++-+---+/    | ||   | ||  ||| |||  
     ||/----+-+-+-++--+--++--+-+--++-+---++-----++--+++-++-+++-+++--+-+-----++-----+-++++---\ ||||  /----+---+-+++-++-+---+-----+-++---+-++-\||| |||  
     |||  /-+-+-+-++--+--++--+-+--++-+---++-----++--+++-++-+++-+++--+-+-----++-----+-++++---+-++++--+----+--\| ||| || |   |     | |\---+-++-++++-+/|  
     |||  | | | | ||  |  ||  | |  || |   ||     ||  ||| || ||| |||  | |    /++-----+-++++---+-++++--+----+--++-+++-++-+---+-----+-+-\  | || |||| | |  
     |||  | | \-+-++--+--/|  | |  || |   ||     ||  ||| || ||| |||  | |    |||     | ||||   | ||||  |    |  || ||| || |   |     | | |  | || |||| | |  
     |||  | |   | ||  |   |  | |  || |   ||     ||  ||| || ||| |||  | |    |||     | ||||   | |\++--+----+--++-+++-++-+---+-----+-+-+--+-++-++++-+-/  
     |||  | \---+-++--+---+--+-/  || |   |\-----++--+++-++-+++-/||  | |    |||     | ||||   | | ||  |    |  || ||| || |   |     | | |  | || |||| |    
     |||  | /---+-++--+---+--+\   \+-+---+------++--+++-++-+++--++--/ |  /-+++-----+-++++---+-+-++--+--\ |  || ||| || |   |     | | |  | || |||| |    
     \++--+-+---+-++--+---+--++----+-+---/      ||  ||| || |||  ||    |/-+-+++-----+-++++---+-+-++--+--+-+--++-+++-++-+---+-----+-+-+--+-++-++++-+---\
      ||  | |/--+-++--+---+-\||    | |          ||  ||| || |||  ||    || | |||     | ||||   | | ||  |  | |  || ||| || |   |     | | |  | || |||| |   |
      ||  | ||  | ||  |   | |||    | |  /-------++--+++-++-+++--++----++-+-+++-----+-++++---+-+-++--+--+-+--++\||| || |   |     | | |  | || |||| |   |
     /++--+-++--+-++--+---+-+++----+-+--+-------++--+++-++-+++--++----++-+-+++\    | ||||   | | || /+--+-+--++++++-++-+---+-----+-+-+\ | || |||| |   |
     |||  | || /+-++--+---+-+++----+-+--+---\   ||  ||| || |||  ||    || | ||||    | ||||   | | || ||  | |  |||||| || |   |     | | || | || |||| |   |
    /+++--+-++-++-++--+---+-+++----+-+--+---+---++--+++-++-+++--++----++-+\||||    | ||||   | | || ||  |/+--++++++-++-+<--+---\ | | || | || |||| |   |
    ||||  | || || ||  |   | |||    | | /+---+---++--+++-++-+++--++----++-++++++----+-++++---+-+-++-++--+++--++++++-++-+---+---+-+\| || | || |||| |   |
    |||| /+-++-++-++--+---+-+++----+-+-++---+---++--+++-++-+++--++----++-++++++--\ | ||||   | | || || /+++--++++++-++-+---+---+-+++-++\| || |||| |   |
    |||| ||/++-++-++--+---+-+++----+-+-++-\ |   ||  ||| || ||| /++----++-++++++--+-+-++++---+-+-++-++-++++--++++++-++-+---+---+-+++-++++-++-++++\|   |
    ||\+-+++++-++-+/  |   | |||    | | || | |  /++--+++-++-+++-+++----++-++++++--+-+-++++---+-+-++-++-++++--++++++-++-+---+---+-+++-++++\|| ||||||   |
/---++-+-+++++-++-+---+---+-+++----+-+-++-+-+--+++--+++-++-+++-+++----++-++++++--+-+-++++---+-+-++-++\||||  |||||| || |   |   | ||| ||||||| ||||||   |
|   || | ||||| || |   |   | |||  /-+-+-++-+\|  |||  ||| || ||| |||    || ||||||  | | ||||   | | || |||||||  |||||| || |   |   | ||| ||||||| ||||||   |
|   || | |^||| || |   |   | |||  | | | || |||  |||  ||| || ||| |||    || ||||\+--+-+-++++---+-+-+/ |||||||  |||||| || |   |   | ||| ||||||| ||||||   |
|   || | ||||| || |   |  /+-+++--+-+-+-++-+++--+++--+++-++-+++-+++----++-++++-+--+-+-++++---+-+-+--+++++++--++++++-++-+---+--\| ||| ||||||| ||||||   |
|   || | ||||| || |   |  || |||  | | | || |||  |||  ||| || ||| |||    |\-++++<+--+-+-++++---+-+-+--+++++++--++++++-++-+---+--++-+++-+++++++-++++++---/
|   || | ||||| || |   |  || |||  | | | || |||  |||  ||| ||/+++-+++----+--++++-+--+-+-++++---+-+-+--+++++++--++++++-++-+---+--++\||| ||||||| |v||||    
|   || | ||||| \+-+---+--++-+++--+-+-+-++-++/  |||  ||| |||||| |||    |  |||| |  | | ||||   | | |  |||||||  |||||| || |   |  |||||| ||||||| ||||||    
|   || | |||||  | |   |  || |||  | | |/++-++---+++--+++-++++++-+++-\  |  |||| |  | | ||||   | | |  |||||||  |||||| || |   |  |||||| ||||||| ||||||    
|   || | |||||  | |   |  || |||  | | |||| ||   |||  ||| |||||| ||| |  |  |||| |  | \-++++---+-/ |  |||||||  |||||| || |   |  |||\++-+++++++-+++++/    
|   || | |||||  ^ |   |  || |\+--+-+-++++-++---+++--+++-+++++/ ||| |  |  |||| |  |   ||||   |   |  |||||||  |||||| || |   |  ||| || ||||||| |||||     
|   || | |||||  | |   |  || | |  | | |||| ||   |||  ||| |||||  ||| |  |  |||| |  |   ||||   |   |  |||||||  |||||| || |   |  ||| || ||||||| |||||     
|   || | |||||  | |   |  || | |  | | |||| ||   |||  ||| |||||  ||| |  |  |||| |  |   ||||   |   |  |||||||  |||||^ || v   |  ||| || ||||||| |||||     
|   || | |||||  | |   |  || | |  | | |||| ||   |||  ||| |||||  ||| |  |  |||| |  |   ||||   |   |  ||||||\--++++++-++-+---+--+++-++-+++++++-+++/|     
|   || | |||||  | |   |  || | |  | | |||| ||   |||  ||| |||||  ||| |/-+--++++-+--+---++++---+---+--++++++---++++++-++-+---+--+++-++-+++++++-+++-+-\   
|   || | ||||| /+-+---+--++-+-+--+-+-++++-++--\|||  ||\-+++++--+++-++-+--++++-+--+---++++---+---+--++++++---+++/|| || | /-+--+++-++-+++++++-+++-+-+--\
|   || | ||||| || |   |  || | |  | | |||| ||  ||||  ||/-+++++--+++-++-+--++++-+-\|   ||||   |   |  ||||||   ||| || || | | |  ||| || ||||||| ||| | |  |
|   || | ||||| || |   |  ||/+-+--+-+-++++-++--++++--+++-+++++--+++-++-+--++++-+-++---++++---+---+--++++++---+++-++-++-+-+\|  ||| || ||||||| ||| | |  |
| /-++-+-+++++-++-+---+--++++-+--+-+-++++-++--++++--+++-+++++--+++-++\|  |||| | ||   ||||   |   |  ||||||   ||| \+-++-+-+++--+++-++-+++++++-++/ | |  |
| | || | ||||| || |   |  |||| |  | | |||| ||/-++++--+++-+++++--+++-++++--++++-+-++---++++--\|   |  ||||||   |||  | || | |||  ||| || ||||||| ||  | |  |
| | || | ||||| || |   |  |||| |  | | |||| ||| ||||  ||| |||||  ||| ||||  |||\-+-++---+++/  ||   |  |||\++---+++--+-++-+-+++--+++-++-++/|||| ||  | |  |
| | || | ||||| || |   |  ||||/+--+-+-++++-+++-++++--+++-+++++--+++-++++--+++--+-++---+++---++---+--+++-++---+++--+-++-+-+++\ ||| || || |||| ||  | |  |
| | || | ||||| || |   |  ||||||  | | |||| ||| ||||  ||| |||||  ||| ||||  |||  | ||   |||   ||   |  \++-++---+++--+-++-+-++++-+++-++-+/ |||| ||  | |  |
| | || | ||||| || \---+--++++++--+-/ |||| ||| |\++--+++-+++++--+++-++++--+++--+-++---+++---++---+---++-++---+++--+-++-+-++++-+++-++-+--+/|| ||  | |  |
| | || | ||||| ||     |  ||||||  |   |||| ||| | \+--+++-+++++--+++-++++--+++--+-++---+++---++---+---++-++---+++--+-++-+-++++-+++-++-+--+-+/ ||  | |  |
| | || | ||||| ||     |  ||||||  |   |||| ||| |  |/-+++-+++++--+++-++++--+++--+-++---+++--\||   |   || ||   |||  | || | |||| ||| || |  | |  ||  | |  |
| | || | ||||| ||     |  ||||||  |   |||| ||| |  || ||| |||||  ||| ||||  \++--+-++---+++--+++---+---++-/|   |||  | || | |||| ||| || |  | |  ||  | |  |
| | || | ||\++-++-----+--++++++--+---++++-/|| |  || ||| |||||  ||| ||||  /++--+-++---+++--+++---+\  ||  |   |||  | || | |||| ||| || |  | |  ||  | |  |
| | || | || || ||     |  ||||||  |   ||||  || |  || ||| |||||  ||| |\++--+++--+-++---+++--+++---++--++--+---+++--+-++-+-++++-+++-++-+--+-+--++--+-/  |
| | || |/++-++-++-----+--++++++--+---++++--++\|  || ||| |||\+--+++-+-++--+++--+-++---+++--+++---++--++--+---+++--+-/| | |||| ||| || |  | |  ||  |    |
| | || |||| || ||     |  ||||||  |   ||\+--++++--++-+++-+++-+--+++-+-++--+++--+-++---+++--+++---++--++--+---+++--+--+-+-++++-+++-/| |  | |  ||  |    |
| | || |||| \+-++-----+--+++++/  |   || |  ||||  || ||| ||| |  ||| | ||  |||  | ||   |||  |||   ||  ||  | /-+++--+--+-+-++++-+++--+\|  | |  ||  |    |
| | || ||||  | ||     |  |||||   |   || |  ||||  \+-+++-+++-+--+++-+-++--+++--+-++---+++--+++---++--++--+-+-+++--/  | | |||| |||  |||  | |  ||  |    |
| | || ||||  | ||     |  |||||   |  /++-+--++++---+\|\+-+++-+--+++-+-+/  |||  | ||   |||  |||   ||  ||  | | |v|     | | |||| |||  |||  | |  ||  |    |
| | || ||||  | ||     |  |||||   |  ||| |  ||||   ||| | ||| |  ||| | |   |||  | ||   ||| /+++---++--++--+-+-+++-----+-+-++++-+++--+++--+-+-\||  |    |
| | || |||\--+-++-----+--+++++---+--+++-+--++++---+++-+-+++-+--+++-+-+---+++--+-++---+++-++++---++--++--+-+-/||     | | |||| |||  |||  | | |||  |    |
| | || |||   | ||     |  |||||   |  ||| |  ||||/--+++-+-+++-+--+++-+-+---+++--+-++---+++-++++---++--++--+-+--++-----+-+-++++-+++--+++--+-+-+++--+---\|
| | || |||   | ||     |  |\+++---+--+++-+--+++++--+++-+-+++-/  ||| | |   |||  | ||   ||| ||||   ||  ||  | |  ||     | | |||| |||  |||  | | |||  |   ||
| | || |||   | ||     |  | |||   |  ||| |  |||||  ||| | |||    ||| | | /-+++--+-++---+++-++++---++--++--+-+--++-----+-+-++++-+++--+++--+-+-+++\ |   ||
| | || |||   | ||     |  | |||   |  ||| |  |||||  ||| | |||    ||\-+-+-+-+++--+-++---+++-++++---++--++--+-+--++-----+-+-++++-+++--+++--+-/ |||| |   ||
| | || |||   | ||/----+--+-+++---+--+++-+--+++++--+++-+-+++----++--+-+-+-+++--+-++---+++-++++---++--++-\| |  ||     | | |||| |||  |||  |   |||| |   ||
| | || |||   | |||    |  | |||   |  ||| |  |||||  ||| | |||    ||  | | | ||| /+-++---+++-++++---++--++-++-+--++-----+-+-++++-+++--+++\ |   |||| |   ||
| | || |||   | \++----+--+-+++---+--+++-+--+++/|  ||| | \++----++--+-+-+-+++-++-++---+++-++++---++--++-++-+--++-----+-+-++++-+++--++++-+---++/| |   ||
| | || |||   |/-++----+--+-+++---+--+++-+--+++-+--+++-+--++----++--+-+-+-+++-++-++---+++-++++---++--++-++-+-\||     | | |||| |||  |||| |   || | |   ||
| | || |||   || ||    |  | |||   |  ||| |  ||| |  ||| |  ||    ||  | | |/+++-++-++---+++-++++--\||  || || | |||     | | |||| |||  |||| |   || | |   ||
| | |\-+++---++-++----+--+-+++---+--+++-+--+++-+--+++-+--++----++--+-+-+++++-+/ ||   ||| ||||  |||  || || | |||     | | |||| |||  |||| |   || | |   ||
| |/+--+++---++-++----+--+-+++---+--+++-+--+++-+--+++-+--++----++--+-+-+++++-+--++---+++-++++\ |||  || || | |||     | | |||| |||  |||| |   || | |   ||
| |||  |||   || ||    | /+-+++---+--+++-+--+++-+--+++-+--++----++-\| | ||||| |  ||   ||| ||||| |||  || || | |||     | | |||| |||  |||| |   || | |   ||
| |||  |||   || ||    | || |||   |  ||| |  ||| |  ||| |  ||    |\-++-+-+++++-+--++---++/ ||||| |||  || || | |||     | | |||| |||  |||| |   || | |   ||
| |||  |||   || ||  /-+-++-+++---+--+++-+-\||| |  ||| |  ||    |  || | |||||/+--++---++--+++++-+++--++-++-+\|||     | | |||| |||  |||| |   || | |   ||
| |||  |||   || ||  | | ||/+++---+--+++-+-++++-+--+++-+-\||    |  || | |||||||  ||   \+--+++++-+++--++-++-+++++-----+-/ |||| |||  ||||/+---++-+-+-\ ||
| |||  |||   || ||  | | ||||||   |  ||| | |||| |  \++-+-+++----+--++-+-+++++++--++----+--+/||| |||  || || |||||     |   |||| |||  ||||||   || | | | ||
| |||  ||v   || ||  | | ||||||   |  ||| | |||| |   || | |||    |  || | \++++++--++----+--+-+++-+++--++-++-+++++-----+---++++-+++--++++++---++-/ | | ||
|/+++--+++---++-++--+-+\||||||   |  ||| | |||| |   || | |||    |  || |  ||||||  ||    |  | ||| |||  || || |||||     |   |||| |||  ||||||   ||   | | ||
|||||  |||   || ||  | ||||||||   |  ||| | |||| |   |\-+-+++----+--++-+--++++++--++----+--+-+++-+++--++-++-+++++-----+---++++-+++--+++++/   ||   | | ||
|||||  |||   || ||  | \+++++++---+--+++-+-++++-+---+--+-+++----+--++-+--++++++--++----+--+-+++-+++--++-++-+++++-----+---++++-+++--/||||    ||   | | ||
|||||  |||   || ||  |/-+++++++---+--+++-+-++++-+---+--+-+++----+--++-+--++++++--++----+--+-+++-+++--++-++-+++++-----+\  |||| |||   ||||    ||   | | ||
|||||  |||   || \+--++-+++++++---+--+++-+-++++-+---+--+-+++----+--++-+--++++++--++----+--+-+++-+++--++-++-+++/|     ||  |||| |||   ||||    ||   | | ||
|||||  |||   ||  |  || |||||||   |  ||| | |||| |   |  | |||    |  || |  ||||||  ||    |  | ||| |||  || || ||| |     ||  |||| |||   ||||    ||   | | ||
|||||  |||   ||  |  || |||||||   |  |\+-+-++++-+---+--+-+++----+--++-+--++++++--++----/  | ||| |||  || || ||| |     ||  |||| |||   ||||    ||   | | ||
|||||  |||   ||  |  || |||||||   |  \-+-+-++++-+---/  \-+++----+--++-+--++++++--/|       | ||| |\+--++-++-+++-+-----++--++/| |||   ||||    ||   | | ||
||\++--+++---++--+--++-+++++++---+----+-+-++++-+--------+++----+--++-/  ||||||   |   /---+-+++-+-+--++-++-+++-+-----++-\|| |/+++---++++----++--\| | ||
|| ||  |||  /++--+--++-+++++++---+----+-+-++++-+--------+++----+--++----++++++---+---+---+-+++-+-+--++-++-+++-+----\|| ||| |||||   ||||    ||  || | ||
|| ||  |||  |||  |  || |||||||   |    | \-++++-+--------+++----+--++----++++++---+---+---+-+++-+-+--++-++-+++-/    ||| ||| |||||   ||||    ||  || | ||
|| ||  ^\+--+++--+--++-+++++++---+----+---+++/ |        |||    |  ||    ||||||   |   |   | ||| | |  || |\-+++------+++-+++-+++/|   ||||    ||  || | ||
|| ||  | |  |||  |  || |||||||   |    |   |||  |        |||    |  ||    ||||||   |   |   | ||| | |  || |  |||      ||| ||| ||| |   ||||    ||  || | ||
|| ||  | |  |||  |  \+-+++++++---+----+---/||  |        |\+----+--++----++++++---+---+---+-+++-+-+--++-+--+++------+/| ||| ||| |   ||||    ||  || | ||
|| ||  | |  |||  |   | |||||||   |    |    ||  |        | |    |  ||   /++++++---+--\|   | ||| | |  || |  |||      | | ||| ||| |   ||||    ||  || | ||
|| ||  | |  |||  |   \-+++++++---+----+----++--+--------+-+----+--++---+++++++---+--++---+-+++-+-+--++-+--+++------+-/ ||| ||| |   ||||    ||  || | ||
|| ||  \-+--+++--+-----+++++++---+----+----++--+--------+-+----+--++---+++++++---+--++---+-+/| | |  \+-+--+++------+---+++-+++-+---++++----+/  || | ||
|\-++----+--+++--+-----/||||||   |    |    ||  |        | |    |  ||   |||||||   |  |\---+-+-+-+-+---+-+--+++------+---/|| ||| |   ||||    |   || | ||
|  ||    |  |||  |      ||||||   |    |    ||  |        | |    |  ||   ||||||\---+--+----+-+-+-+-+---+-+--+++------+----++-+++-+---++/|    |   || | ||
|  ||    |  |||  |      |\++++---+----+----++--+--------+-+----+--++---++++++----+--+----+-+-+-+-+---+-+--+++------+----++-++/ |   || |    |   || | ||
|  ||    |  |||  |   /--+-++++---+----+----++--+--------+-+----+--++---++++++--\ |  |    | | | | |   | |  |||      |    || ||  |   || |    |   || | ||
|  ||    |  |||  |   |  | ||||   |    |    |\--+--------+-+----+--++---++++++--+-+--+----+-/ | | |   | |  ||v      |    || ||  |   || |    |   || | ||
|  ||    |  |||  \---+--+-++++---+----+----+---+--------+-+----+--++---++++++--+-+--+----+---+-+-+---+-/  |||      |    || ||  |   || |    |   || | ||
|  ||    |  |||      |  | |\++---+----+----+---+--------+-+----+--++---++++++--+-+--+----+---+-+-+---+----+++------+----+/ ||  |   || |    |   || | ||
|  ||    |  |||      |  | | ||   |    |   /+---+--------+-+-\  |  || /-++++++--+-+--+---<+---+-+-+---+----+++------+----+-\||  |   || |    |   || | ||
|  ||    |  |||      |  | | ||   |    |   ||   |        | | |  |  || | ||||\+--+-+--+----+---+-+-+---+----+++------+----+-+++--+---+/ |    |   || | ||
|  ||    |  |||      |  \-+-++---+----+---++---+--------+-+-+--+--/| | |||| |  | |  |    |   | | |   |    |||      |    | |||  |   |  |    |   || | ||
|  ||    |  |\+------+----+-/|   |    |   ||   |        | | |  |   | | |||| |  | |  |    |   | | |   |/---+++------+\   | |||  |   |  |    |   || | ||
|  ||    |  | |      |    |  |   |    |   ||   |        | | |  |   | | |||| |  | |  |    |   | | |   ||   |||      ||   \-+++--+---+--+----+---++-+-+/
|  ||    |  \-+------+----+--+---+----+---++---+--------+-+-+--+---+-+-++++-+--+-+--+----+---+-+-+---++---+++------/|     |||  |   |  |    |   || | | 
|  ||    |    \------+----+--+---+----+---++---+--------+-+-+--+---+-+-++++-+--+-+--+----+---+-+-+---++---++/       |     |||  |   |  |    |   || | | 
\--++----+-----------+----+--+---+----+---++---+--------+-+-+--+---+-+-++++-+--+-+--+----+---+-+-+---/|   ||        |     |||  |   |  |    |   || | | 
   ||    \-----------+----+--+---+----+---++---+--------+-+-+--+---+-+-++++-+--+-/  |    |   | | |    |   ||        |     |||  |   |  |    |   || | | 
   ||                |    |  \---+----+---++---+--------+-+-+--+---+-+-++++-+--+----+----+---+-+-+----+---++--------+-----+/|  |   |  |    |   || | | 
   ||                |    |      |    |   ||   |        | | |  |   | | |||| |  |    |    \---+-+-+----+---++--------+-----+-+--+---+--+----/   || | | 
   |\----------------+----+------+----+---++---+--------+-+-+--+---+-+-+++/ |  |    |        | | |    |   \+--------+-----+-+--+---/  |        || | | 
   |        /--------+----+------+----+---++---+----<---+-+-+--+---+-+-+++--+--+----+--------+-+-+----+----+--------+\    | |  |      |        || | | 
   |        |        |    |      \----+---+/   |        | | |  |   | | |\+--+--+----+--------+-/ |    |    |        ||    | |  |      |        || | | 
   |        |        |    |           |   |    \--------+-+-+--+---+-+-+-+--+--+----+--------+---+----+----+--------++----+-+--+------+--------++-+-/ 
   \--------+--------+----+-----------+---+-------------+-+-+--+---+-+-+-+--+--+----+--------/   |    |    |        ||    | |  |      |        || |   
            |        |    |           |   |             | | |  |   | | \-+--+--+----/            |    |    |        ||    | |  |      |        || |   
            |        |    |           |   |             | | |  |   | |   |  |  |                 |    |    |        ||    | \--+------+--------/| |   
            |        |    |           \---+-------------+-+-+--+---/ |   |  |  |                 |    \----+--------/|    |    |      |         | |   
            |        |    |               |             | | |  |     |   \--+--+-----------------/         |         |    |    |      |         | |   
            |        |    |               |             | | |  \-----+------+--+---------------------------+---------+----+----+------+---------/ |   
            |        |    |               \-------------+-+-/        |      \--+---------------------------/         |    |    |      |           |   
            |        |    |                             | |          \---------+-------------------------------------+----/    |      \-----------/   
            \--------+----+-----------------------------+-+--------------------+-------------------------------------/         |                      
                     \----+----------->-----------------+-+--------------------/                                               |                      
                          \-----------------------------/ \--------------------------------------------------------------------/                      
